<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="bmstable" content="hardhead.json">
    <title>発狂DPBMS難度推定表 HARD</title>
    <link href="style.css" rel="stylesheet">
</head>
<body>

<h1>発狂DPBMS難度推定表 HARD</h1>

<p><a href="http://ereter.net/">ereter's dp laboratory</a>の難易度推定値を使用した難易度表です。</p>

<p>BeMusicSeekerで本難易度表のカスタムフォルダを作成する場合、以下の設定を推奨します。</p>

<ol>
	<li>左ツリーの難易度表を右クリック
	<li>プロパティ
	<li>一般タブ
	<li>フォルダ接頭辞
	<li>「LEVEL 」→「DP推定H★」 へ変更
</ol>

<table id="difficulty_index">
    <caption>Quick Link</caption>
    <tr>
        <td><a href="#H★0.75">H★0.75</a>
        <td><a href="#H★1.00">H★1.00</a>
        <td><a href="#H★1.25">H★1.25</a>
        <td><a href="#H★1.50">H★1.50</a>
        <td><a href="#H★1.75">H★1.75</a>
        <td><a href="#H★2.00">H★2.00</a>
        <td><a href="#H★2.25">H★2.25</a>
        <td><a href="#H★2.50">H★2.50</a>
        <td><a href="#H★2.75">H★2.75</a>
        <td><a href="#H★3.00">H★3.00</a>
        <td><a href="#H★3.25">H★3.25</a>
    <tr>
        <td><a href="#H★3.50">H★3.50</a>
        <td><a href="#H★3.75">H★3.75</a>
        <td><a href="#H★4.00">H★4.00</a>
        <td><a href="#H★4.25">H★4.25</a>
        <td><a href="#H★4.50">H★4.50</a>
        <td><a href="#H★4.75">H★4.75</a>
        <td><a href="#H★5.00">H★5.00</a>
        <td><a href="#H★5.25">H★5.25</a>
        <td><a href="#H★5.50">H★5.50</a>
        <td><a href="#H★5.75">H★5.75</a>
        <td><a href="#H★6.00">H★6.00</a>
    <tr>
        <td><a href="#H★6.25">H★6.25</a>
        <td><a href="#H★6.50">H★6.50</a>
        <td><a href="#H★6.75">H★6.75</a>
        <td><a href="#H★7.00">H★7.00</a>
        <td><a href="#H★7.25">H★7.25</a>
        <td><a href="#H★7.50">H★7.50</a>
        <td><a href="#H★7.75">H★7.75</a>
        <td><a href="#H★8.00">H★8.00</a>
        <td><a href="#H★8.25">H★8.25</a>
        <td><a href="#H★8.50">H★8.50</a>
        <td><a href="#H★8.75">H★8.75</a>
    <tr>
        <td><a href="#H★9.00">H★9.00</a>
        <td><a href="#H★9.25">H★9.25</a>
        <td><a href="#H★9.50">H★9.50</a>
        <td><a href="#H★9.75">H★9.75</a>
        <td><a href="#H★10.00">H★10.00</a>
        <td><a href="#H★10.25">H★10.25</a>
        <td><a href="#H★10.50">H★10.50</a>
        <td><a href="#H★10.75">H★10.75</a>
        <td><a href="#H★11.00">H★11.00</a>
        <td><a href="#H★11.25">H★11.25</a>
        <td><a href="#H★11.50">H★11.50</a>
    <tr>
        <td><a href="#H★11.75">H★11.75</a>
        <td><a href="#H★12.00">H★12.00</a>
        <td><a href="#H★12.25">H★12.25</a>
        <td><a href="#H★12.50">H★12.50</a>
        <td><a href="#H★12.75">H★12.75</a>
        <td><a href="#H★13.00">H★13.00</a>
        <td><a href="#H★13.25">H★13.25</a>
        <td><a href="#H★13.50">H★13.50</a>
        <td><a href="#H★13.75">H★13.75</a>
        <td><a href="#H★14.00">H★14.00</a>
        <td><a href="#H★？">H★？</a>
</table>

<a accesskey="l" href="..">L) 戻る</a>

<table id="difficulty_table">
    <caption><progress>LOADING...</progress></caption>
    <thead>
        <tr class="tr_header">
            <td class="level">LV
            <td class="title">TITLE
            <td class="artist">ARTIST
            <td class="url">URL
            <td class="diff_url">DIFF_URL
            <td class="comment">COMMENT
    <tbody>
        <!-- ここに難易度表本体を生成する -->
</table>

<script>
    var IR_url = "http://www.dream-pro.info/~lavalse/LR2IR/search.cgi?mode=ranking&bmsmd5=";
    var header_url = document.querySelector("meta[name='bmstable']").getAttribute("content");

    // 難易度表データjsonを取得してテーブル生成関数を呼び出す
    var oReq = new XMLHttpRequest();
    oReq.open("GET", header_url);
    oReq.onload = function (oEvent) {
        var header = JSON.parse(oReq.response);
    
        var oReq2 = new XMLHttpRequest();
        oReq2.open("GET", header.data_url);
        oReq2.onload = function (oEvent2) {
            var data = JSON.parse(oReq2.response);
    
            makeBMSTable(data, header.symbol);
        };
        oReq2.send();
    };
    oReq.send();
    
    // テーブル生成関数
    function makeBMSTable(rows, symbol) {
        // 進捗初期設定
        var progress = document.querySelector("#difficulty_table progress");
        progress.max = rows.length - 1;
        
        // 難易度表データ注入
        var tbody = document.querySelector("#difficulty_table > tbody");
        tbody.innerHTML = rows.reduce(function (acc, row, idx, array) {
            // 進捗どうですか
            progress.value = idx;

            // レベル区切りのキャプションを生成
            if (idx === 0 || row.level !== array[idx - 1].level) {
                var count = array.filter(function (arr) {
                    return arr.level === row.level;
                }).length;
                
                acc += (
                    "<tr id='" + symbol + row.level + 
                    "' class='tr_separate'><th colspan='6'>" + symbol + row.level + 
                    " (" + count + "譜面)"
                );
            }
    
            // 譜面データ行を生成
            return acc + (
                "<tr class='tr_normal' title='" + symbol + row.rawlevel + "'><td>" + symbol + row.level + 
                "<td><a href='" + IR_url + row.md5 + "' target='_blank'>" + row.title + 
                "<\/a><td>" + row.artist + 
                "<td><a href='" + row.url + "' target='_blank'>" + row.url +
                "<td><a href='" + row.url_diff + "' target='_blank'>" + row.url_diff +
                "<td>" + row.comment
            );
        }, "");
        
        // 進捗爆破
        progress.parentNode.removeChild(progress);
    }
</script>

<a href="..">L) 戻る</a>

</body>
</html>