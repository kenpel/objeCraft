<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="bmstable" content="head14.json">
    <title>発狂14keyBMS闇鍋難易度表</title>
    <link href="style.css" rel="stylesheet">
</head>
<body>

<h1>発狂14keyBMS闇鍋難易度表</h1>

<ul>
    <li>対象オプション：不問
    <li>song.dbから自動出力しているため、この世に存在しない譜面が入っている可能性があります。
    <li>ARTISTの末尾に自分用のオプションが混じっています。
    <li>★10強からは<a href="http://ereter.net/dpoverjoy/">DP Overjoy</a>基準になります。
</ul>

<p>BeMusicSeekerで本難易度表のカスタムフォルダを作成する場合、以下の設定を推奨します。</p>

<ol>
	<li>左ツリーの難易度表を右クリック
	<li>プロパティ
	<li>一般タブ
	<li>フォルダ接頭辞
	<li>「LEVEL 」→「14key闇★」 へ変更
</ol>

<p>本難易度表の譜面ファイルの自動アーカイブが可能になったため、譜面のみで良ければ、<a href="https://twitter.com/objeCraft">@objeCraft</a>までご連絡頂ければまとめてお渡し出来るようになりました。<br>
※追加音源等は一切無いため、一部の差分は正常に再生できません。予めご了承下さい。</p>

<table id="difficulty_index">
    <caption>Quick Link</caption>
    <tr>
        <td><a href="#★?">★?</a>
        <td><a href="#★1">★1</a>
        <td><a href="#★2">★2</a>
        <td><a href="#★3">★3</a>
        <td><a href="#★4">★4</a>
        <td><a href="#★5">★5</a>
        <td><a href="#★6">★6</a>
        <td><a href="#★7">★7</a>
        <td><a href="#★8">★8</a>
        <td><a href="#★9">★9</a>
	<tr>
        <td><a href="#★10">★10</a>
        <td><a href="#★★1">★★1</a>
        <td><a href="#★★2">★★2</a>
        <td><a href="#★★3">★★3</a>
        <td><a href="#★★4">★★4</a>
        <td><a href="#★★5">★★5</a>
        <td><a href="#★★6">★★6</a>
        <td><a href="#★★7">★★7</a>
        <td><a href="#★★8">★★8</a>
        <td><a href="#★★9">★★9</a>
    <tr>
        <td><a href="#★★10">★★10</a>
        <td><a href="#★★11">★★11</a>
        <td><a href="#★★12">★★12</a>
        <td><a href="#★★13">★★13</a>
        <td><a href="#★★14">★★14</a>
        <td><a href="#★★15">★★15</a>
        <td><a href="#★★16">★★16</a>
        <td><a href="#★★17">★★17</a>
        <td><a href="#★無理">★無理</a>
        <td>/
</table>

<a accesskey="l" href="..">L) 戻る</a>

<table id="difficulty_table">
    <caption><progress>LOADING...</progress></caption>
    <thead>
        <tr class="tr_header">
            <td class="level">LV
            <td class="title">TITLE
            <td class="artist">ARTIST
            <td class="genre">GENRE
    <tbody>
        <!-- ここに難易度表本体を生成する -->
</table>

<script>
    var IR_url = "http://www.dream-pro.info/~lavalse/LR2IR/search.cgi?mode=ranking&bmsmd5=";
    var header_url = document.querySelector("meta[name='bmstable']").getAttribute("content");

    // 難易度表データjsonを取得してテーブル生成関数を呼び出す
    var oReq = new XMLHttpRequest();
    oReq.open("GET", header_url);
    oReq.onload = function (oEvent) {
        var header = JSON.parse(oReq.response);
    
        var oReq2 = new XMLHttpRequest();
        oReq2.open("GET", header.data_url);
        oReq2.onload = function (oEvent2) {
            var data = JSON.parse(oReq2.response);
    
            makeBMSTable(data, header.symbol);
        };
        oReq2.send();
    };
    oReq.send();
    
    // テーブル生成関数
    function makeBMSTable(rows, symbol) {
        // 進捗初期設定
        var progress = document.querySelector("#difficulty_table progress");
        progress.max = rows.length - 1;
        
        // 難易度表データ注入
        var tbody = document.querySelector("#difficulty_table > tbody");
        tbody.innerHTML = rows.reduce(function (acc, row, idx, array) {
            // 進捗どうですか
            progress.value = idx;

            // レベル区切りのキャプションを生成
            if (idx === 0 || row.level !== array[idx - 1].level) {
                var count = array.filter(function (arr) {
                    return arr.level === row.level;
                }).length;
                
                acc += (
                    "<tr id='" + symbol + row.level + 
                    "' class='tr_separate'><th colspan='4'>" + symbol + row.level + 
                    " (" + count + "譜面)"
                );
            }
    
            // 譜面データ行を生成
            return acc + (
                "<tr class='tr_normal'><td>" + symbol + row.level + 
                "<td><a href='" + IR_url + row.md5 + "' target='_blank'>" + row.title + 
                "<\/a><td>" + row.artist + 
                "<td>" + row.comment
            );
        }, "");
        
        // 進捗爆破
        progress.parentNode.removeChild(progress);
    }
</script>

<a href="..">L) 戻る</a>

</body>
</html>